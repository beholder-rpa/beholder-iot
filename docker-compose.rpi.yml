version: "2.4"

services:
  ###############################################
  # Beholder Cortex
  beholder-cortex:
    image: beholderrpa/iot-cortex-arm32v7:master
  ###############################################
  # Beholder Stalk
  beholder-stalk:
    image: beholderrpa/iot-stalk-v2-arm32v7:master
    devices:
      - "/dev/hidg0:/dev/hidg0"
      - "/dev/hidg1:/dev/hidg1"
      - "/dev/hidg2:/dev/hidg2"
  ###############################################
  # Beholder Nexus
  beholder-nexus:
    # If this is not present, clock_gettime fails
    privileged: true
  ###############################################
  # Beholder Reverse Proxy
  beholder-traefik:
    environment: 
      - beholder_hostname=${BEHOLDER_HOSTNAME}
    labels:
      - traefik.enable=true
      - traefik.http.routers.dashboard.rule=Host(`${BEHOLDER_TRAEFIK_HOSTNAME}`)
      - traefik.http.routers.dashboard.entrypoints=websecure
      - traefik.http.routers.dashboard.tls=true
      - traefik.http.routers.dashboard.service=api@internal
  ###############################################
  # Watchtower
  watchtower:
    image: containrrr/watchtower
    container_name: beholder-watchtower
    restart: unless-stopped
    environment: 
      - "WATCHTOWER_SCHEDULE=15 * * * * *"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
  